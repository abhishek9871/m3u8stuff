# VidSrc VRF Research

This directory contains research and tools for understanding and generating VRF tokens for the vidsrc.cc API.

## Background

vidsrc.cc uses a VRF (Verification Request Field) token to authenticate API requests:

```
GET /api/{tmdbId}/servers?id={tmdbId}&type={type}&v={base64}&vrf={VRF_TOKEN}&imdbId={imdbId}
```

Without a valid VRF token, the API returns:
```json
{"message":["vrf must be a string"],"error":"Bad Request","statusCode":400}
```

## API Chain (Discovered via Playwright)

### Step 1: Get Servers
```
GET https://vidsrc.cc/api/278/servers
    ?id=278
    &type=movie
    &v=VGhlIFNoYXdzaGFuayBSZWRlbXB0aW9uXzE5OTRfbnVsbA==  (base64: "The Shawshank Redemption_1994_null")
    &vrf=OUKI7I96KdfeqRXxtvXXiw                           (THE VRF TOKEN)
    &imdbId=tt0111161
```

Response:
```json
{
  "data": [
    {"name": "VidPlay", "hash": "8gRy+i3edPAB..."},
    {"name": "UpCloud", "hash": "8gRy+i3edPAB..."},
    {"name": "GoCloud(Hindi audio)", "hash": "8gRy+i3edPAB..."}
  ],
  "success": true
}
```

### Step 2: Get Source (using hash)
```
GET https://vidsrc.cc/api/source/{hash}
```

Response:
```json
{
  "data": {
    "type": "hls",
    "source": "https://lightningbolt.site/_v27/...m3u8?code=...&hash=...",
    "subtitles": [...]
  },
  "success": true
}
```

### Step 3: Play M3U8
Requires headers:
```
Referer: https://vidsrc.cc/
Origin: https://vidsrc.cc
```

## VRF Generation Analysis

### Obfuscated Code Location

The VRF is generated by JavaScript on the embed page:

1. **Main script**: `https://vidsrc.cc/saas/js/embed.min.js` (~173KB)
2. **Inline script**: Large obfuscated block with:
   - `window['ZpQw9XkLmN8c3vR3']` = encoded data string
   - `_0x4880()` = string array (~1500 encoded strings)
   - `_0x3ef7()` = decoder with base64 + rotation

### Server-Injected Variables

The embed page includes these variables (set by server):
```javascript
var v = "VGhlIFNoYXdzaGFuayBSZWRlbXB0aW9uXzE5OTRfbnVsbA==";  // base64(title_year_null)
var client = "MjQwMTo0OTAwOjFjZDc6YTU2MjoxNTVhOjU0NDE6...";  // base64(IPv6)
var userId = "BCMYPgQdJnkGHQg-BiMPIxMNKn8QHRx7BCMm...";       // encoded user ID
var imdbId = "tt0111161";
var movieId = "278";
var movieType = "movie";
```

### VRF Token Characteristics

- Length: ~22 characters
- Alphabet: URL-safe base64 (`A-Za-z0-9-_`)
- Example: `OUKI7I96KdfeqRXxtvXXiw`

## Two Tracks for Implementation

### Track A: Runtime-Assisted (Fastest)

Instead of reverse-engineering VRF:
1. Run Playwright/headless browser
2. Navigate to embed page
3. Intercept `/api/{id}/servers` network request
4. Extract hash values from response
5. Return to our app

**Pros**: Works immediately, no deobfuscation needed
**Cons**: Requires running a browser somewhere

### Track B: Direct VRF Generation (Long-term)

Reverse-engineer the obfuscated JS:
1. Deobfuscate `_0x3ef7()` string decoder
2. Identify VRF generation function
3. Extract minimal code needed
4. Patch for Worker compatibility

**Pros**: No external service needed
**Cons**: Complex, may break if vidsrc updates

## Files in This Directory

- `vrfSandbox.ts` - Skeleton for VRF generation (Track B)
- `README.md` - This file

## TODO

- [ ] Capture and save raw obfuscated scripts
- [ ] Analyze string decoder function
- [ ] Identify VRF entry point
- [ ] Extract minimal VRF logic
- [ ] Test in Worker environment
